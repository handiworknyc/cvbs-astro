---
import BaseLayout from "../layouts/MainLayout.astro";
import LayoutRenderer from "../lib/wp/LayoutRenderer.astro";
import { getAllFlexiblePagePaths, getFlexiblePageByUri } from "../lib/api"; // adjust import path

export async function getStaticPaths() {
  return getAllFlexiblePagePaths();
}

const { slug = [] } = Astro.params;
const uri = "/" + (Array.isArray(slug) ? slug.join("/") : slug) + "/";
const page = getFlexiblePageByUri(uri);

if (!page) return Astro.redirect("/404");
---

<BaseLayout title={page.title}>
  <LayoutRenderer layouts={page.layouts || []} />
</BaseLayout>